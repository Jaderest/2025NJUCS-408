# 第一章 计算机系统概述

## 目录
- [第一章 计算机系统概述](#第一章-计算机系统概述)
  - [目录](#目录)
  - [1.2 计算机系统层次结构](#12-计算机系统层次结构)
    - [1.2.1 计算机系统的组成](#121-计算机系统的组成)
    - [1.2.2计算机硬件](#122计算机硬件)
      - [冯·诺依曼机](#冯诺依曼机)
      - [计算机的功能部件](#计算机的功能部件)
      - [一些概念](#一些概念)
    - [1.2.3 计算机软件](#123-计算机软件)
      - [系统软件和应用软件](#系统软件和应用软件)
      - [三个级别的语言](#三个级别的语言)
      - [软硬件逻辑功能等价性](#软硬件逻辑功能等价性)
    - [1.2.4 计算机系统的层次结构](#124-计算机系统的层次结构)
    - [计算机系统的工作原理](#计算机系统的工作原理)
      - [“存储程序”工作方式](#存储程序工作方式)
      - [从源程序到可执行文件](#从源程序到可执行文件)
      - [指令执行过程](#指令执行过程)


## 1.2 计算机系统层次结构

### 1.2.1 计算机系统的组成
- **硬件系统**和**软件系统**共同构成了一个完整的计算机系统
- 某功能既可用软件实现、又可用硬件实现，则称*软/硬件在逻辑功能上是等价的*
- 设计计算机系统时，考虑软硬件的功能分配

### 1.2.2计算机硬件

#### 冯·诺依曼机
- 冯·诺依曼机特点如下
  1. 采用“存储程序”的工作方式
  2. 计算机硬件系统由运算器、存储器、控制器、输入设备和输出设备五大部件组成
  3. 指令和数据以同等地位存储在存储器中，形式上没有区别，但计算机应能区分它们
  4. 指令和数据以二进制代码表示
  5. 指令由操作码和地址码组成，操作码指出操作的类型，地址码指出操作数的地址

- “存储程序”的基本思想
  - 将事先编制好的程序和原始数据送入**主存储器**后才能执行
  - 一旦程序被启动执行，**无须**操作人员的**干预**，计算机会**自动逐条执行**指令，直至程序结束

#### 计算机的功能部件
- 输入设备
- 输出设备
- 存储器
  - 主存储器
    - MAR（存储器地址寄存器）
      - 寻址，位数反映最多可寻址的存储单元的个数
      - 现代计算机存在于CPU中
    - MDR（存储器数据寄存器）
      - 位数=存储字长，一般为字节的2次幂的整数倍
      - 现代计算机存在于CPU中
    - 时序控制逻辑——产生存储器操作所需的各种时序信号
    - 存储器
      - 由许多*存储单元*构成，每个存储单元包含若干*存储元件*，每个存储元件存储**一个**二进制位
      - 存储单元可存储一串二进制代码，称这串代码为**存储字**
      - 存储字的位数为**存储字长**，1B(8bit) 或是字节的偶数倍
  - 辅助存储器
- 运算器
  - 核心组成是：ALU（算术逻辑单元）
  - 若干通用寄存器（前三个寄存器必须具备）
    - ACC（累加器）
    - MQ（乘商寄存器）
    - X（操作数寄存器）
    - IX（变址寄存器）
    - BR（基址寄存器）
  - 标志寄存器
    - PSW（程序状态字寄存器）
      - 存放ALU运算得到的一些标志信息或处理机的状态信息
      - 如溢出、进位/借位、结果是否为负
- 控制器
  - PC（程序计数器）
    - 存放当前将要执行的指令的地址
    - 与主存储器MAR有直接通路
  - IR（指令寄存器）
    - 存放当前指令
    - 内容来自主存的MDR
    - OP送至CU，分析指令发出各种微操作命令序列
    - Ad送至MAR，取出操作数
  - CU（控制单元）

#### 一些概念
- 控制器 + 运算器 = 中央处理器（CPU）
- CPU + 主存储器 = 主机
- 其他硬件装置（外存，I/O设备等） = 外部设备（外设）
- CPU和主存通过通过一组总线相连
  - 地址总线：MAR地址信息，指向主存储器存储单元（被读写的）
  - 控制总线：读写信号线，指出CPU写入主存/主存读至CPU；MDR数据送至数据线/数据线数据接收至MDR
  - 数据总线


### 1.2.3 计算机软件

#### 系统软件和应用软件
- 系统软件——一组保证计算机系统高效、正确运行的基础软件，作为系统资源**提供给用户**使用
  - OS
  - DBMS
  - 分布式系统
  - 网络软件系统
  - 标准库
  - 服务性程序等
- 应用软件——**用户**为解决问题**编制**的程序

#### 三个级别的语言
- 语言
  - 机器语言
  - 汇编语言
  - 高级语言
- 翻译程序
  - 汇编程序
  - 解释程序
  - 编译程序

#### 软硬件逻辑功能等价性
- 软硬件逻辑功能等价性——指某一功能既可用软件实现，又可用硬件实现
  - 浮点运算，可用浮点运算器硬件实现，也可用软件实现
  - 硬件实现性能优于软件实现


### 1.2.4 计算机系统的层次结构
1. 微程序机器层（硬件层）
2. 传统机器语言层（机器层）
3. 操作系统层
4. 汇编语言层
5. 高级语言层

- 无软件的纯硬件系统称为*裸机*
- 3~5层称为*虚拟机器*——软件实现的机器
- 下层是上层的基础
- 上层是下层的扩展
- 软硬件间界面：ISA
  - 指令集体系结构（Instruction Set Architecture）
  - 是软件能感知到的部分，也称软件可见部分


### 计算机系统的工作原理

#### “存储程序”工作方式
- 需要将程序所含的指令和数据送入主存储器，程序开始启动执行，无须干预，自动逐条取指令和执行
- 指令执行过程（联想做菜）
  - 根据PC从主存中取指令（寻找需要的菜谱）
  - 对指令进行译码（看菜谱）
  - 计算下一条指令地址
  - 取出操作数（准备食材）
  - 执行（烹饪）
  - 将结果送回存储器（出餐）

#### 从源程序到可执行文件
- 翻译过程分为四个阶段完成
  - 预处理阶段 .c -> .i
  - 编译阶段 .i -> .s
  - 汇编阶段 .s -> .o
  - 链接阶段 .o -> 可执行文件

#### 指令执行过程
- 可执行文件中代码段由一条一条机器指令构成
- （取数，送至运算器的ACC）指令执行信息流程如下
  - 取指令：PC->MAR->M->MDR->IR
    - 根据PC取指令到IR
  - 译码：IR->CU
    - 指令译码并送出控制信号
  - 执行指令：IR->MAR->M->MDR->ACC
    - 取数操作
  - 取完指令还需为下一条指令做准备，计算下一条指令地址，(PC) + 1 -> PC
    - 加个括号，表示寄存器中存储的内容