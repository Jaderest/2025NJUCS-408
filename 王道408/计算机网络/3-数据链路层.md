# 第三章 数据链路层

## 目录
- [第三章 数据链路层](#第三章-数据链路层)
  - [目录](#目录)
  - [3.1 数据链路层的功能](#31-数据链路层的功能)
    - [3.1.1 数据链路层所处地位](#311-数据链路层所处地位)
      - [数据链路层理解](#数据链路层理解)
      - [基本概念](#基本概念)
    - [3.1.2 链路管理](#312-链路管理)
    - [3.1.3 封装成帧与透明传输](#313-封装成帧与透明传输)
      - [封装成帧](#封装成帧)
    - [3.1.4 流量控制](#314-流量控制)
    - [3.1.5 差错检测](#315-差错检测)

## 3.1 数据链路层的功能
- 三个基本问题
  - 封装成帧（组帧）
  - 透明传输
  - 差错检测
- 数据链路层使用的信道
  - 点对点信道，一对一的通信方式
    - PPP目前使用最广泛的点对点协议
  - 广播信道，这种信道上连接的主机很多，使用一对多广播通信方式
    - 有限局域网CSMA/CD协议
    - 无线局域网CSMA/CA协议

### 3.1.1 数据链路层所处地位

#### 数据链路层理解
考虑 主机H1 --局域网1-> 路由器R1 --广域网-> 路由器R2 --局域网2-> 主机H2
- 学习数据链路层时，通常只关系协议栈中 **水平方向的各数据链路层**
- 可通过如下链路 H1链路层 -> R1链路层 -> R2链路层 -> H2链路层
  - 这三段不同的数据链路可能采用**不同**的数据链路层协议

#### 基本概念
- 链路：指一个节点到**相邻节点**的一段物理线路
  - 两台计算机之间的通信路径往往经过许多段链路 —— 链路只是一条路径的组成部分
  - 链路 又称 物理链路
- 数据链路：
  - 在链路上传送数据时，除了需要链路本身，还需要**必要的通信协议**来控制这些数据的传输
  - 把实现这些协议的硬件和软件加到链路上，构成了数据链路
  - 数据链路 又称 逻辑链路
- 帧
  - 数据链路层对等实体之间进行逻辑通信的协议数据单元
    - 数据链路层把网络层下交的数据构成 帧 发送到链路
    - 接收到的 帧 中的数据取出交给网络层

### 3.1.2 链路管理
- 链路管理：数据链路层连接的 建立、维持和释放过程
  - 主要用于面向连接的服务
- 链路两端的节点要进行通信
  - 首先确认对方已处于就绪状态
  - 交换必要信息以对帧序号初始化，才能建立连接
  - 传输过程中要维持连接，而在传输完毕后释放该连接

### 3.1.3 封装成帧与透明传输

#### 封装成帧
- 指在一段数据前后分别添加首部和尾部，构成**帧**
  - 帧是数据链路层的传送单元
- **帧长**：数据部分长度加上首部尾部长度
- 帧定界：首部尾部有很多控制信息，重要作用是确定帧的界限
  - 接收方能从接收到的二进制比特流中区分帧的开始与结束
- HDLC协议中
  - 用标识位F（01111110）作为帧的开始和结束标志，帧格式如下：  
    |标志F|地址A（8位）|控制C（8位）|信息I（N位可变）|帧检验序列FCS（16位）|标志F|
- 为提高帧传输效率
  - 数据部分长度应尽可能大于首部和尾部长度
  - 但帧长增加，传输差错概率也提高，发送差错重传代价也越大
  - **最大传送单元**：每种链路层协议规定帧**数据部分**的最大长度
- **透明**：表示某个实际存在的事物看起来不存在一样
  - 举个例子，数据中恰好出现与帧界符相同的比特序列，则会错误地提前结束帧
- **透明传输**：不论什么比特组合的数据都能**按照原样无差错**地在数据链路上传输
  - 理解：数据看不见数据链路有什么妨碍传输的数据（这里例子就是标志F），所以数据链路层对于数据来说就是透明的

### 3.1.4 流量控制
- 流量控制：限制发送方发送速率，使之不超过接收方接收能力
  - 需要某种反馈机制
- OSI中，数据链路层具有流量控制功能
  - 控制相邻节点链路上的流量
- TCP/IP体系中，这个功能移到传输层
  - 控制从源到目的端之间的流量

### 3.1.5 差错检测
- 错误种类
  - 位错：CRC检验
  - 帧错：帧丢失、帧重复、帧失序

- OSI中
  - CRC校验
  - 给帧添加了帧编号、确认（发送的每个帧增加一个计时器）和重传机制

- 现代实现中
  - 通信质量良好的有线链路，数据链路层已不再使用确认和重传机制，仅需CRC校验丢弃错误帧
  - 重传交给高层协议完成